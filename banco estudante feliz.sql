DROP DATABASE IF EXISTS ESTUDANTE_FELIZ;
CREATE DATABASE ESTUDANTE_FELIZ;
USE ESTUDANTE_FELIZ;

CREATE TABLE RESPONSAVEL(
	ID_RESPONSAVEL INT NOT NULL PRIMARY KEY,
	NOME_RESPONSAVEL VARCHAR(100) NOT NULL,
	EMAIL VARCHAR(100) NOT NULL
);

CREATE TABLE TELEFONE_RESPONSAVEL(
	ID_TELEFONE INT NOT NULL PRIMARY KEY,
	TELEFONE VARCHAR(11) NOT NULL,
	IDRESPONSAVEL INT NOT NULL,
	FOREIGN KEY (IDRESPONSAVEL) REFERENCES RESPONSAVEL (ID_RESPONSAVEL)
);

CREATE TABLE ALUNO(
	ID_ALUNO INT NOT NULL PRIMARY KEY,
	NOME_ALUNO VARCHAR(100) NOT NULL,
	DT_NASCIMENTO DATE NOT NULL,
	SEXO CHAR(1) NOT NULL,
	TIPO_DEFICIENCIA VARCHAR(80)
);

CREATE TABLE ESCOLA(
	ID_ESCOLA INT NOT NULL PRIMARY KEY,
	NOME_ESCOLA VARCHAR(100) NOT NULL,
	STATUS VARCHAR(15) NOT NULL,
	IDALUNO INT NOT NULL,
	CONSTRAINT FK_ALUNO_ESCOLA FOREIGN KEY(IDALUNO) REFERENCES ALUNO(ID_ALUNO)
);

CREATE TABLE FUNCIONARIO(
	ID_FUNCIONARIO INT NOT NULL PRIMARY KEY,
	NOME_FUNCIONARIO VARCHAR(100) NOT NULL,
	CARGO VARCHAR(50),
	IDESCOLA INT NOT NULL,
	CONSTRAINT FK_ESCOLA_FUNCIONARIO FOREIGN KEY(IDESCOLA) REFERENCES ESCOLA (ID_ESCOLA)
);

CREATE TABLE RESPONSAVEL_FUNCIONARIO(
	IDRESPONSAVEL INT NOT NULL,
	IDFUNCIONARIO INT NOT NULL,
	CONSTRAINT FK_RESPONSAVEL_FUNCIONARIO FOREIGN KEY (IDRESPONSAVEL) REFERENCES RESPONSAVEL (ID_RESPONSAVEL),
	CONSTRAINT FK_FUNCIONARIO_RESPONSAVEL FOREIGN KEY (IDFUNCIONARIO) REFERENCES FUNCIONARIO (ID_FUNCIONARIO),
	CONSTRAINT PK_RESPONSAVEL_FUNCIONARIO PRIMARY KEY (IDRESPONSAVEL,IDFUNCIONARIO)
);

CREATE TABLE RESPONSAVEL_ESCOLA(
	IDRESPONSAVEL INT NOT NULL,
	IDESCOLA INT NOT NULL,
	CONSTRAINT PK_RESPONSAVEL_ESCOLA PRIMARY KEY (IDRESPONSAVEL, IDESCOLA),
	CONSTRAINT FK_RESPONSAVEL_ESCOLA FOREIGN KEY (IDRESPONSAVEL) REFERENCES RESPONSAVEL (ID_RESPONSAVEL),
	CONSTRAINT FK_ESCOLA_RESPONSAVEL FOREIGN KEY (IDESCOLA) REFERENCES ESCOLA (ID_ESCOLA)
);

CREATE TABLE TELEFONE_ESCOLA(
	ID_TELEFONE_ESCOLA INT NOT NULL PRIMARY KEY,
	TELEFONE VARCHAR(11) NOT NULL,
	IDESCOLA INT NOT NULL,
	CONSTRAINT FK_TELEFONE_ESCOLA FOREIGN KEY (IDESCOLA) REFERENCES ESCOLA (ID_ESCOLA)
);

CREATE TABLE ENDERECO_RESPONSAVEL_ALUNO(
	ID_ENDERECO INT NOT NULL PRIMARY KEY,
	RUA VARCHAR(100) NOT NULL,
	BAIRRO VARCHAR(100) NOT NULL,
	CIDADE VARCHAR(100) NOT NULL,
	IDRESPONSAVEL INT NOT NULL,
	IDALUNO INT NOT NULL,
	CONSTRAINT FK_ENDERECO_RESPONSAVEL FOREIGN KEY (IDRESPONSAVEL) REFERENCES RESPONSAVEL (ID_RESPONSAVEL),
	CONSTRAINT FK_ENDERECO_ALUNO FOREIGN KEY (IDALUNO) REFERENCES ALUNO (ID_ALUNO)
);

CREATE TABLE ENDERECO_ESCOLA(
	ID_ENDERECO_ESCOLA INT NOT NULL PRIMARY KEY,
	RUA VARCHAR(100) NOT NULL,
	BAIRRO VARCHAR(100) NOT NULL,
	CIDADE VARCHAR(100) NOT NULL,
	IDESCOLA INT NOT NULL,
	CONSTRAINT FK_ENDERECO_ESCOLA FOREIGN KEY (IDESCOLA) REFERENCES ESCOLA (ID_ESCOLA)
);

--------- ADICIONANDO VALORES NA TABELA DE RESPONSÁVEL ---------

INSERT INTO RESPONSAVEL(ID_RESPONSAVEL,NOME_RESPONSAVEL,EMAIL) VALUES (1,'CARLOS AUGUSTO','CARLOS14@GMAIL.COM');
INSERT INTO RESPONSAVEL(ID_RESPONSAVEL,NOME_RESPONSAVEL,EMAIL) VALUES (2,'LILIANE BEZERRA','LILI94@OUTLOOK.COM');
INSERT INTO RESPONSAVEL(ID_RESPONSAVEL,NOME_RESPONSAVEL,EMAIL) VALUES (3,'DJALMA FONSECA','DJALMAF95@GMAIL.COM');
INSERT INTO RESPONSAVEL(ID_RESPONSAVEL,NOME_RESPONSAVEL,EMAIL) VALUES (4,'RAPHAEL SOARES','RAPHA_SZMIHO@GMAIL.COM');
INSERT INTO RESPONSAVEL(ID_RESPONSAVEL,NOME_RESPONSAVEL,EMAIL) VALUES (5,'ALEXANDRE NASCIMENTO','IGARADTM@GMAIL.COM');

--------- ADICIONANDO VALORES NA TABELA DE TELEFONE RESPONSÁVEL ---------

INSERT INTO TELEFONE_RESPONSAVEL (ID_TELEFONE,TELEFONE,IDRESPONSAVEL) VALUES (1,'12345-6789',1);
INSERT INTO TELEFONE_RESPONSAVEL (ID_TELEFONE,TELEFONE,IDRESPONSAVEL) VALUES (2,'98774-1428',2);
INSERT INTO TELEFONE_RESPONSAVEL (ID_TELEFONE,TELEFONE,IDRESPONSAVEL) VALUES (3,'92518-4026',3);
INSERT INTO TELEFONE_RESPONSAVEL (ID_TELEFONE,TELEFONE,IDRESPONSAVEL) VALUES (4,'93080-2525',4);
INSERT INTO TELEFONE_RESPONSAVEL (ID_TELEFONE,TELEFONE,IDRESPONSAVEL) VALUES (5,'98334-1349',5);

--------- ADICIONANDO VALORES NA TABELA DE ALUNOS ---------

INSERT INTO ALUNO (ID_ALUNO,NOME_ALUNO,DT_NASCIMENTO,SEXO,TIPO_DEFICIENCIA) VALUES (1,'MARIA EDUARDA OLIVEIRA DA SILVA','2017-05-23','F','DEFICIÊNCIA AUDITIVA');
INSERT INTO ALUNO (ID_ALUNO,NOME_ALUNO,DT_NASCIMENTO,SEXO,TIPO_DEFICIENCIA) VALUES (2,'JOÃO VITOR RODRIGUES DE SOUZA','2018-11-01','M','DEFICIÊNCIA MOTORA');
INSERT INTO ALUNO (ID_ALUNO,NOME_ALUNO,DT_NASCIMENTO,SEXO,TIPO_DEFICIENCIA) VALUES (3,'ISABELA DIAS GONÇALVES PIRES','2016-01-25','F',NULL);
INSERT INTO ALUNO (ID_ALUNO,NOME_ALUNO,DT_NASCIMENTO,SEXO,TIPO_DEFICIENCIA) VALUES (4,'MATHEUS HENRIQUE QUEIROZ','2016-12-25','M',NULL);
INSERT INTO ALUNO (ID_ALUNO,NOME_ALUNO,DT_NASCIMENTO,SEXO,TIPO_DEFICIENCIA) VALUES (5,'LUCIANA PEIXOTO SABINO MOREIRA','2018-02-02','F',NULL);

--------- ADICIONANDO VALORES NA TABELA DE ESCOLAS ---------

INSERT INTO ESCOLA (ID_ESCOLA,NOME_ESCOLA,STATUS,IDALUNO) VALUES (1,'COLÉGIO 2001','DISPONÍVEL',1);
INSERT INTO ESCOLA (ID_ESCOLA,NOME_ESCOLA,STATUS,IDALUNO) VALUES (2,'COLÉGIO DAMAS','DISPONÍVEL',2);
INSERT INTO ESCOLA (ID_ESCOLA,NOME_ESCOLA,STATUS,IDALUNO) VALUES (3,'COLÉGIO AMERICANO BATISTA','INDISPONÍVEL',3);
INSERT INTO ESCOLA (ID_ESCOLA,NOME_ESCOLA,STATUS,IDALUNO) VALUES (4,'COLÉGIO NOVA OLINDA','INDISPONÍVEL',4);
INSERT INTO ESCOLA (ID_ESCOLA,NOME_ESCOLA,STATUS,IDALUNO) VALUES (5,'COLÉGIO SALESIANO RECIFE','DISPONÍVEL',5);

--------- ADICIONANDO VALORES NA TABELA DE FUNCIONÁRIOS ---------

INSERT INTO FUNCIONARIO (ID_FUNCIONARIO,NOME_FUNCIONARIO,CARGO,IDESCOLA) VALUES (1,'FÁTIMA PEREIRA GOMES','DIRETORA',1);
INSERT INTO FUNCIONARIO (ID_FUNCIONARIO,NOME_FUNCIONARIO,CARGO,IDESCOLA) VALUES (2,'CARLA FERNANDA MONTEIRO','PROFESSORA',2);
INSERT INTO FUNCIONARIO (ID_FUNCIONARIO,NOME_FUNCIONARIO,CARGO,IDESCOLA) VALUES (3,'ELIAS MUNIZ BEZERRA DA SILVA','ZELADOR',3);
INSERT INTO FUNCIONARIO (ID_FUNCIONARIO,NOME_FUNCIONARIO,CARGO,IDESCOLA) VALUES (4,'ALYSSON BRENO FERREIRA','PROFESSOR',4);
INSERT INTO FUNCIONARIO (ID_FUNCIONARIO,NOME_FUNCIONARIO,CARGO,IDESCOLA) VALUES (5,'PATRÍCIA SILVEIRA CORDEIRO','MONITORA',5);

--------- ADICIONANDO VALORES NA TABELA DE RESPONSAVEL_FUNCIONARIO ---------

INSERT INTO RESPONSAVEL_FUNCIONARIO (IDRESPONSAVEL,IDFUNCIONARIO) VALUES (1,1);
INSERT INTO RESPONSAVEL_FUNCIONARIO (IDRESPONSAVEL,IDFUNCIONARIO) VALUES (2,2);
INSERT INTO RESPONSAVEL_FUNCIONARIO (IDRESPONSAVEL,IDFUNCIONARIO) VALUES (3,3);
INSERT INTO RESPONSAVEL_FUNCIONARIO (IDRESPONSAVEL,IDFUNCIONARIO) VALUES (4,4);
INSERT INTO RESPONSAVEL_FUNCIONARIO (IDRESPONSAVEL,IDFUNCIONARIO) VALUES (5,5);

--------- ADICIONANDO VALORES NA TABELA DE RESPONSAVEL_ESCOLA ---------

INSERT INTO RESPONSAVEL_ESCOLA (IDRESPONSAVEL,IDESCOLA) VALUES (1,1);
INSERT INTO RESPONSAVEL_ESCOLA (IDRESPONSAVEL,IDESCOLA) VALUES (2,2);
INSERT INTO RESPONSAVEL_ESCOLA (IDRESPONSAVEL,IDESCOLA) VALUES (3,3);
INSERT INTO RESPONSAVEL_ESCOLA (IDRESPONSAVEL,IDESCOLA) VALUES (4,4);
INSERT INTO RESPONSAVEL_ESCOLA (IDRESPONSAVEL,IDESCOLA) VALUES (5,5);

--------- ADICIONANDO VALORES NA TABELA DE TELEFONE_ESCOLA ---------

INSERT INTO TELEFONE_ESCOLA (ID_TELEFONE_ESCOLA,TELEFONE,IDESCOLA) VALUES (1,'3439-1944',1);
INSERT INTO TELEFONE_ESCOLA (ID_TELEFONE_ESCOLA,TELEFONE,IDESCOLA) VALUES (2,'3139-4500',2);
INSERT INTO TELEFONE_ESCOLA (ID_TELEFONE_ESCOLA,TELEFONE,IDESCOLA) VALUES (3,'2122-5599',3);
INSERT INTO TELEFONE_ESCOLA (ID_TELEFONE_ESCOLA,TELEFONE,IDESCOLA) VALUES (4,'3011-9700',4);
INSERT INTO TELEFONE_ESCOLA (ID_TELEFONE_ESCOLA,TELEFONE,IDESCOLA) VALUES (5,'2129-5900',5);

--------- ADICIONANDO VALORES NA TABELA DE ENDERECO_RESPONSAVEL_ALUNO ---------

INSERT INTO ENDERECO_RESPONSAVEL_ALUNO (ID_ENDERECO,RUA,BAIRRO,CIDADE,IDRESPONSAVEL,IDALUNO) VALUES (1,'RUA ALBA VALDEZ Nº 87','TIMBI','CAMARAGIBE',1,1);
INSERT INTO ENDERECO_RESPONSAVEL_ALUNO (ID_ENDERECO,RUA,BAIRRO,CIDADE,IDRESPONSAVEL,IDALUNO) VALUES (2,'RUA DA PAZ Nº 115','AFOGADOS','RECIFE',2,2);
INSERT INTO ENDERECO_RESPONSAVEL_ALUNO (ID_ENDERECO,RUA,BAIRRO,CIDADE,IDRESPONSAVEL,IDALUNO) VALUES (3,'RUA PADRE LEMOS Nº 28','CASA AMARELA','RECIFE',3,3);
INSERT INTO ENDERECO_RESPONSAVEL_ALUNO (ID_ENDERECO,RUA,BAIRRO,CIDADE,IDRESPONSAVEL,IDALUNO) VALUES (4,'RUA DO IMPERADOR Nº 22','DOIS IRMÃOS','RECIFE',4,4);
INSERT INTO ENDERECO_RESPONSAVEL_ALUNO (ID_ENDERECO,RUA,BAIRRO,CIDADE,IDRESPONSAVEL,IDALUNO) VALUES (5,'RUA PARANÁ Nº 43','JARDIM BRASIL','OLINDA',5,5);

--------- ADICIONANDO VALORES NA TABELA DE ENDERECO_ESCOLA ---------

INSERT INTO ENDERECO_ESCOLA (ID_ENDERECO_ESCOLA,RUA,BAIRRO,CIDADE,IDESCOLA) VALUES (1,'RUA PROF. JOSÉ CÂNDIDO PESSOA Nº 323', 'BAIRRO NOVO', 'OLINDA',1);
INSERT INTO ENDERECO_ESCOLA (ID_ENDERECO_ESCOLA,RUA,BAIRRO,CIDADE,IDESCOLA) VALUES (2,'AV RUI BARBOSA Nº 1426', 'GRAÇAS', 'RECIFE',2);
INSERT INTO ENDERECO_ESCOLA (ID_ENDERECO_ESCOLA,RUA,BAIRRO,CIDADE,IDESCOLA) VALUES (3,'RUA DOM BOSCO Nº 1308', 'BOA VISTA', 'RECIFE',3);
INSERT INTO ENDERECO_ESCOLA (ID_ENDERECO_ESCOLA,RUA,BAIRRO,CIDADE,IDESCOLA) VALUES (4,'AV PRESIDENTE KENNEDY Nº 3857', 'SÃO BENEDITO', 'OLINDA',4);
INSERT INTO ENDERECO_ESCOLA (ID_ENDERECO_ESCOLA,RUA,BAIRRO,CIDADE,IDESCOLA) VALUES (5,'RUA DOM BOSCO Nº 551', 'BOA VISTA', 'RECIFE',5);

SELECT 
	ES.NOME_ESCOLA AS [NOME ESCOLA]
   ,TE.TELEFONE AS [TELEFONE ESCOLA]
   ,AL.NOME_ALUNO AS [NOME ALUNO]
FROM ESCOLA ES
INNER JOIN TELEFONE_ESCOLA TE
	ON ES.ID_ESCOLA = TE.IDESCOLA
INNER JOIN ALUNO AL
	ON AL.ID_ALUNO = ES.IDALUNO;

SELECT 
	RE.NOME_RESPONSAVEL AS [NOME RESPONSAVEL]
   ,RE.EMAIL
   ,TR.TELEFONE AS [TELEFONE RESPONSAVEL]
FROM RESPONSAVEL RE
INNER JOIN TELEFONE_RESPONSAVEL TR
ON RE.ID_RESPONSAVEL = TR.IDRESPONSAVEL;

SELECT 
		ES.NOME_ESCOLA AS [COLÉGIO]
	   ,EE.RUA
	   ,EE.BAIRRO
	   ,EE.CIDADE
	   ,TELEFONE
	   ,NOME_ALUNO AS [NOME DO ALUNO]
FROM ESCOLA ES
INNER JOIN ENDERECO_ESCOLA EE
		ON ES.ID_ESCOLA = EE.IDESCOLA
INNER JOIN TELEFONE_ESCOLA TE
		ON ES.ID_ESCOLA = TE.IDESCOLA
INNER JOIN ALUNO AL
		ON AL.ID_ALUNO = ES.IDALUNO;
		

/* Relatórios */

-- 1- Listar os nomes de todos os funcinoários e de seus responsáveis.
SELECT 
	F.NOME_FUNCIONARIO AS [NOME FUNCIONARIO]
   ,RE.NOME_RESPONSAVEL AS [NOME RESPONSAVEL]
FROM RESPONSAVEL RE
INNER JOIN RESPONSAVEL_FUNCIONARIO RF
	ON RE.ID_RESPONSAVEL = RF.IDRESPONSAVEL
INNER JOIN FUNCIONARIO F
	ON F.ID_FUNCIONARIO = RF.IDFUNCIONARIO;

-- 2- Listar o nome das escolas e o nome dos funcionários das escolas do município de Recife.
SELECT 
	ES.NOME_ESCOLA AS [COLÉGIO]
   ,FU.NOME_FUNCIONARIO AS [FUNCIONÁRIO]
   ,EE.CIDADE
FROM ESCOLA ES
INNER JOIN FUNCIONARIO FU
	ON ES.ID_ESCOLA = FU.IDESCOLA
INNER JOIN ENDERECO_ESCOLA EE
	ON ES.ID_ESCOLA = EE.IDESCOLA 
	AND EE.CIDADE = 'RECIFE'; 

-- 3- Listar nome completo, data de nascimento dos alunos sem deficiência.
SELECT NOME_ALUNO, DT_NASCIMENTO, TIPO_DEFICIENCIA
FROM ALUNO
WHERE TIPO_DEFICIENCIA IS NULL;

-- 4- Apresentar a quantidde de funcionarios por creche. 
SELECT NOME_ESCOLA COUNT(NOME_FUNCIONARIO) AS [FUNCIONÁRIOS] 
FROM ESCOLA
group by NOME_ESCOLA;

-- 5- Informar a quantidade de alunos com deficiciência, por creche.

SELECT 
	COUNT(NOME_ALUNO) AS [ALUNOS COM DEFICIÊNCIA]  
FROM ALUNO AL 
LEFT JOIN ESCOLA ES 
	ON AL.ID_ALUNO = ES.IDALUNO 
WHERE TIPO_DEFICIENCIA IS NOT NULL
GROUP BY ES.NOME_ESCOLA;